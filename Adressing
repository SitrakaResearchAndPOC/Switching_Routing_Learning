Tutoriel : Configuration IP et test de connectivitÃ© avec deux conteneurs Ubuntu (Docker)
ğŸ¯ Objectifs

CrÃ©er deux conteneurs Ubuntu avec Docker

Tester lâ€™affichage des interfaces (ip addr, ifconfig)

Attribuer des adresses IP statiques avec diffÃ©rentes mÃ©thodes (ip, ifconfig, nmcli, netplan)

VÃ©rifier lâ€™adressage attribuÃ©

Tester la connectivitÃ© entre conteneurs avec ping

1. PrÃ©parer lâ€™environnement

Installer Docker si ce nâ€™est pas dÃ©jÃ  fait :

sudo apt update
sudo apt install docker.io -y
sudo systemctl enable --now docker


CrÃ©er un rÃ©seau bridge Docker :

sudo docker network create --subnet=192.168.100.0/24 mynet

2. Lancer deux conteneurs Ubuntu
# VM1
sudo docker run -dit --name vm1 --net mynet --ip 192.168.100.10 ubuntu:22.04 bash

# VM2
sudo docker run -dit --name vm2 --net mynet --ip 192.168.100.20 ubuntu:22.04 bash


Entrer dans chaque conteneur :

sudo docker exec -it vm1 bash
sudo docker exec -it vm2 bash


âš ï¸ Par dÃ©faut, Ubuntu minimal nâ€™a pas ifconfig, ping, ni nmcli. On les installe :

apt update
apt install -y iproute2 net-tools iputils-ping network-manager

3. Affichage des interfaces
Avec ip
ip addr

Avec ifconfig
ifconfig

4. Ajout dâ€™adresses IP (statiques, temporaires)
ğŸ”¹ MÃ©thode 1 : avec ip
ip addr add 192.168.100.30/24 dev eth0


VÃ©rification :

ip addr show dev eth0

ğŸ”¹ MÃ©thode 2 : avec ifconfig
ifconfig eth0 192.168.100.40 netmask 255.255.255.0 up


VÃ©rification :

ifconfig eth0

ğŸ”¹ MÃ©thode 3 : avec nmcli

CrÃ©er une connexion statique :

nmcli con add type ethernet ifname eth0 con-name static-vm ipv4.addresses 192.168.100.50/24 ipv4.method manual
nmcli con up static-vm


VÃ©rification :

nmcli dev show eth0

ğŸ”¹ MÃ©thode 4 : avec Netplan (permanent)

Dans un conteneur Docker, Netplan nâ€™est pas utilisÃ© par dÃ©faut (car le rÃ©seau est gÃ©rÃ© par Docker).
Mais tu peux quand mÃªme forcer une config permanente en crÃ©ant un fichier YAML dans /etc/netplan/.

Exemple /etc/netplan/01-netcfg.yaml :

network:
  version: 2
  ethernets:
    eth0:
      dhcp4: no
      addresses:
        - 192.168.100.60/24


Puis appliquer :

netplan apply


VÃ©rification :

ip addr show eth0

5. Test de connectivitÃ© avec ping

Depuis vm1 vers vm2 :

ping -c 4 192.168.100.20


Depuis vm2 vers vm1 :

ping -c 4 192.168.100.10


RÃ©sultat attendu âœ… : des rÃ©ponses ICMP positives.

6. RÃ©sumÃ© comparatif
MÃ©thode	Commande principale	Persistance aprÃ¨s reboot	Utilisable dans Docker
ip addr	ip addr add ...	âŒ Temporaire	âœ… Oui
ifconfig	ifconfig ...	âŒ Temporaire	âœ… Oui
nmcli	nmcli con add ...	âœ… Persistance	âš ï¸ Possible si NetworkManager activÃ©
netplan	Fichier YAML /etc/netplan/*.yaml	âœ… Persistance	âš ï¸ Fonctionne, mais rarement utilisÃ© en Docker

ğŸ‘‰ Veux-tu que je transforme Ã§a en un TP pÃ©dagogique structurÃ© (avec objectifs, matÃ©riel, Ã©tapes, questions de vÃ©rification pour les Ã©tudiants) que tu pourrais utiliser en cours/labo ?

Vous avez ditÂ :
comment affichÃ© les differents interfaces via nmcli
ChatGPT a ditÂ :

Bonne question ğŸ‘Œ

Avec nmcli (lâ€™outil en ligne de commande de NetworkManager), tu peux lister et afficher les interfaces de plusieurs faÃ§ons :

ğŸ”¹ 1. Lister les pÃ©riphÃ©riques rÃ©seau (interfaces)
nmcli device


â¡ï¸ Affiche toutes les interfaces dÃ©tectÃ©es (eth0, lo, wlan0, etc.) avec leur Ã©tat (connectÃ©, dÃ©connectÃ©, non-gÃ©rÃ©).

Exemple de sortie :

DEVICE  TYPE      STATE      CONNECTION         
eth0    ethernet  connectÃ©  Wired connection 1
lo      loopback  non-gÃ©rÃ©  --

ğŸ”¹ 2. Afficher les dÃ©tails dâ€™une interface spÃ©cifique
nmcli device show eth0


â¡ï¸ Donne toutes les infos : adresse MAC, IP, masque, DNS, etc.

ğŸ”¹ 3. Voir uniquement les connexions gÃ©rÃ©es par NetworkManager
nmcli connection show


â¡ï¸ Liste les profils configurÃ©s (par ex. Wired connection 1, static-vm1, etc.).

ğŸ”¹ 4. Afficher toutes les interfaces avec leurs propriÃ©tÃ©s
nmcli -p device show


(-p = mode "pretty", pour une sortie lisible avec des sÃ©parateurs).

ğŸ‘‰ RÃ©sumÃ© rapide :

Liste des interfaces â†’ nmcli device

DÃ©tails dâ€™une interface â†’ nmcli device show eth0

Liste des connexions configurÃ©es â†’ nmcli connection show

Veux-tu que je prÃ©pare un tableau comparatif entre ip addr, ifconfig, et nmcli pour montrer comment chacun affiche les interfaces ?

Vous avez ditÂ :
mÃªme question avec netplan
ChatGPT a ditÂ :

Avec Netplan, la logique est un peu diffÃ©rente : Netplan ne fournit pas directement de commande pour lister les interfaces, car il est avant tout un outil de configuration rÃ©seau dÃ©clarative, et non un outil de diagnostic ou dâ€™affichage en temps rÃ©el.

Voici comment on peut â€œafficher les interfacesâ€ dans un contexte Netplan :

1ï¸âƒ£ VÃ©rifier les fichiers de configuration Netplan

Netplan stocke la configuration des interfaces dans des fichiers YAML sous :

/etc/netplan/


Par exemple :

ls /etc/netplan/
cat /etc/netplan/01-netcfg.yaml


â¡ï¸ Cela montre quelles interfaces sont configurÃ©es (eth0, ens33, etc.), leurs adresses statiques ou DHCP, gateways, DNS, etc.

2ï¸âƒ£ Appliquer et tester la configuration

AprÃ¨s avoir configurÃ© un fichier Netplan :

sudo netplan apply


Pour vÃ©rifier lâ€™interface et les adresses appliquÃ©es, on utilise les commandes systÃ¨me classiques :

ip addr show
ifconfig


âš ï¸ Netplan lui-mÃªme ne remplace pas ip addr ou ifconfig. Il gÃ©nÃ¨re la configuration pour systemd-networkd ou NetworkManager selon le renderer choisi, et câ€™est ensuite le renderer qui gÃ¨re les interfaces.

3ï¸âƒ£ VÃ©rifier le renderer utilisÃ©
netplan get


ou pour une interface spÃ©cifique :

netplan get ethernets.eth0


â¡ï¸ Affiche la configuration telle que Netplan la lit pour lâ€™interface eth0.

âœ… En rÃ©sumÃ© :
Objectif	Commande Netplan	Remarque
Voir quelles interfaces sont configurÃ©es	ls /etc/netplan/ + cat fichier.yaml	Netplan est dÃ©claratif, pas dynamique
Voir les adresses effectives	ip addr show ou ifconfig	Netplan applique la config, mais nâ€™affiche pas directement
Voir le renderer	netplan get	Montre la configuration appliquÃ©e

Si tu veux, je peux te faire un mini guide visuel â€œaffichage interfaces via ip / ifconfig / nmcli / netplanâ€, avec un exemple pour chaque commande, pour que ce soit trÃ¨s clair et directement exploitable.

Veuxâ€‘tu que je fasse Ã§aâ€¯?

Vous avez ditÂ :
et netplan show ne marche pas?
ChatGPT a ditÂ :

Ah oui, exactement ! âœ…

En fait, netplan show existe et peut Ãªtre utilisÃ© pour afficher la configuration active ou prÃ©vue par Netplan, mais son fonctionnement dÃ©pend un peu de la version de Netplan et du renderer utilisÃ© (NetworkManager ou systemd-networkd).

1ï¸âƒ£ Utilisation basique
sudo netplan show


Affiche toutes les interfaces configurÃ©es avec leurs adresses statiques ou DHCP, gateways, et routes.

Câ€™est un moyen rapide et lisible de voir ce que Netplan va appliquer.

Exemple de sortie :

network:
  version: 2
  ethernets:
    eth0:
      dhcp4: no
      addresses: [192.168.100.10/24]
      gateway4: 192.168.100.1
      nameservers:
          addresses: [8.8.8.8,8.8.4.4]

2ï¸âƒ£ Comparaison avec cat /etc/netplan/*.yaml

cat affiche simplement le fichier YAML brut.

netplan show affiche la configuration telle que Netplan la lit, aprÃ¨s avoir fusionnÃ© tous les fichiers YAML.

3ï¸âƒ£ VÃ©rifier lâ€™interface et les adresses rÃ©elles

MÃªme si netplan show montre la config, pour voir les interfaces actives et leurs adresses il faut toujours passer par :

ip addr show
ifconfig

âœ… En rÃ©sumÃ©

netplan show â†’ configuration prÃ©vue par Netplan

ip addr / ifconfig â†’ Ã©tat rÃ©el des interfaces sur le systÃ¨me

nmcli â†’ interfaces gÃ©rÃ©es par NetworkManager

Si tu veux, je peux te crÃ©er un mini tableau comparatif complet : comment Netplan, NMCLI, ip addr, et ifconfig affichent les interfaces et adresses IP, avec exemple concret sur un conteneur Ubuntu.

Veuxâ€‘tu que je fasse Ã§aâ€¯?
